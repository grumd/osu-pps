import{L as v,E as S,T as p,F,u as I,P as L,S as A}from"./usePersistQuery.0e23decf.js";import{s as l,c as w,b as s,j as e,u as C,h as B,i as P,k as E,A as D,ah as N,E as R,t as $,a as o,r as g,F as O,o as j,f as W,S as y,ai as z,aj as U,ag as H}from"./index.dece521a.js";import{m as K}from"./match-sorter.esm.18bcef0d.js";import{I as T}from"./Input.a66527b6.js";import{T as Q}from"./index.b7813640.js";const _=l("span",{display:"flex",alignItems:"center",variants:{type:{zero:{color:w.textBlue},negative:{color:w.textRed},positive:{color:w.textGreen}}}}),G=l("span",{width:"0.8rem",fontSize:"80%",variants:{small:{true:{fontSize:"60%"}}}}),J=({delta:t})=>s(_,{type:t===0?"zero":t>0?"positive":"negative",children:[e(G,{small:Math.abs(t)<8,children:t===0?"\u25A0":t>0?"\u25B2":"\u25BC"}),Math.abs(t)]}),X=t=>{var h;const i=C(),a=B(),{isLoading:d,error:r,data:c}=P(["scores",i,t,(h=a.data)==null?void 0:h.lastUpdated],()=>E({url:`${D}/data/ranking/${i}/player-scores/${t}.json`}));return{isLoading:a.isLoading||d,error:a.error||r,data:c}},q=l("div",{whiteSpace:"normal"}),V=({item:t})=>{const{data:i,error:a,isLoading:d}=X(t.id);return e(q,{children:d?e(v,{}):a instanceof Error?e(S,{children:a.message}):i?s("table",{style:{width:"100%",borderSpacing:"0.5em"},children:[e("thead",{children:s("tr",{children:[s("td",{children:["updated ",e(Q,{date:new Date(t.minuteUpdated*60*1e3)})]}),e("td",{children:e(p,{nowrap:!0,children:"original pp"})}),e("td",{children:e(p,{nowrap:!0,children:"adjusted"})}),e("td",{children:e(p,{nowrap:!0,children:"weighted"})})]})}),e("tbody",{children:i.map((r,c)=>{const h=N(r.mods);return s("tr",{children:[s("td",{children:[e(R,{url:$(r.beatmapId),children:r.title}),h&&" +"+h]}),e("td",{children:s(p,{nowrap:!0,children:[e(p,{faded:!0,children:r.ppOld})," ",s(p,{color:r.ppNew>=r.ppOld?"green":"red",children:[r.ppNew>=r.ppOld?"+":"",r.ppNew-r.ppOld," ="]})]})}),s("td",{children:[e(p,{nowrap:!0,bold:!0,children:r.ppNew}),e(p,{faded:!0,children:"pp"})]}),e("td",{children:s(p,{faded:!0,nowrap:!0,children:[Math.round(r.ppNew*Math.pow(.95,c))," (",Math.round(Math.pow(.95,c)*100),"%)"]})})]},`${r.beatmapId}_${r.mods}`)})})]}):e(S,{children:"Data not found"})})},Y=l(F,{marginRight:o.sm}),M=l("tr",{background:w.bgElement,borderRadius:o.sm,"& > td:first-child":{borderTopLeftRadius:o.sm,borderBottomLeftRadius:o.sm},"& > td:last-child":{borderTopRightRadius:o.sm,borderBottomRightRadius:o.sm}}),m=l("td",{whiteSpace:"nowrap",padding:`${o.xs} ${o.md}`}),Z=({item:t})=>{const[i,a]=g.exports.useState(!1);return s(O,{children:[s(M,{children:[s(m,{css:{width:"4.8em"},children:["#",t.place]}),e(m,{css:{width:"4.8em"},children:e(J,{delta:t.placeOld-t.place})}),e(m,{css:{width:"55%"},children:e(R,{url:j(t.id),children:t.name})}),e(m,{css:{textAlign:"center",fontWeight:"bold"},children:Math.round(t.ppNew)}),e(m,{css:{textAlign:"right",width:"1em",fontSize:W[75],padding:o.xs},children:s(y,{color:"indigo",onClick:()=>a(d=>!d),children:[e(Y,{flipped:i})," scores"]})})]}),i&&e(M,{children:e(m,{colSpan:5,children:e(V,{item:t})})})]})},b=20,ee=l("div",{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}),te=l("table",{maxWidth:o.tableMaxWidth,width:"100%",borderSpacing:`0 ${o.xs}`,borderCollapse:"separate"}),x=l("th",{whiteSpace:"nowrap"}),ne=l(T,{fontWeight:"normal",maxWidth:"20em",width:"95%"}),re=l("div",{display:"flex",alignItems:"center",gap:o.xs,"& > input":{width:"2em"}}),ae=({rankings:t})=>{const[i,a]=g.exports.useState(1),[d,r]=g.exports.useState(""),c=g.exports.useMemo(()=>t.sort((n,u)=>u.ppOld-n.ppOld).map((n,u)=>({...n,placeOld:u+1})).sort((n,u)=>u.ppNew-n.ppNew).map((n,u)=>({...n,place:u+1})),[t]),{data:h,pagesCount:f}=g.exports.useMemo(()=>{let n=c;return d&&(n=K(c,d,{keys:["name"]})),{data:n.slice((i-1)*b,i*b),pagesCount:Math.ceil(n.length/b)}},[c,i,d]),k=g.exports.useCallback(n=>{r(n),a(1)},[]);return e(ee,{children:s(te,{children:[e("thead",{children:s("tr",{children:[e(x,{colSpan:2,children:s(re,{children:[e(y,{iconButtonKind:"default",kind:"light",onClick:()=>a(n=>Math.max(1,n-1)),children:e(z,{})}),e(T,{withHighlight:!1,type:"number",value:i,onChange:n=>a(Math.min(f,Math.max(1,n!=null?n:1)))}),e(y,{iconButtonKind:"default",kind:"light",onClick:()=>a(n=>Math.min(f,n+1)),children:e(U,{})})]})}),e(x,{css:{textAlign:"left"},children:e(ne,{placeholder:"search names...",type:"text",onChange:k,value:d})}),e(x,{children:"pp"}),e(x,{})]})}),s("tbody",{children:[h.length===0&&d?e("tr",{children:e("td",{style:{textAlign:"center"},colSpan:5,children:"Didn't find a user with this name :("})}):null,h.map(n=>e(Z,{item:n},n.id))]})]})})},se=()=>{const t=C(),[i,a]=g.exports.useState(null),d=async f=>await H({path:`data/ranking/${f}/players.csv`,setProgress:a}),{isLoading:r,error:c,data:h}=I(["rankings",t],()=>(a(null),d(t)));return{isLoading:r,error:c,data:h,progress:i}},ie=l("main",{flex:"1 1 0px",display:"flex",flexFlow:"column nowrap","& > footer":{display:"flex",alignItems:"center",justifyContent:"center",padding:o.sm}});function pe(){const{isLoading:t,error:i,data:a,progress:d}=se();return s(ie,{children:[i instanceof Error&&e(S,{children:i.message}),e("header",{children:t&&d!==null&&e(L,{css:{margin:"0 auto"},progress:d})}),e(A,{css:{flex:"1 1 0px",display:"flex",flexFlow:"column nowrap",alignItems:"center"},children:a&&e(ae,{rankings:a})})]})}export{pe as default};
