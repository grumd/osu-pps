import{m as y}from"./match-sorter.esm.16e7c48c.js";import{u as h,h as C,i as j,k as g,A as M,r as o,b as x,l as R,j as i,a as u,s as v,F as k}from"./index.8d92f515.js";import{E as S,L as b,u as I,S as P}from"./usePersistQuery.3b0be470.js";import{I as A}from"./Input.30bd2f72.js";import{M as U,a as D}from"./MapperSubRow.f4310fa5.js";import"./index.a3bc3766.js";import"./Text.5b0ebb29.js";const Q=e=>{var n;const p=h(),a=C(),{isLoading:s,error:r,data:t}=j(["mapper-maps",p,e,(n=a.data)==null?void 0:n.lastUpdated],()=>g({url:`${M}/data/mappers/${p}/favored-mappers-maps/${e}.json`}));return{isLoading:a.isLoading||s,error:a.error||r,data:t}},W=o.exports.memo(function({mapper:p}){const{data:a,isLoading:s,error:r}=Q(p.id),t=o.exports.useMemo(()=>a==null?void 0:a.map(n=>({value:n.count,id:n.id,text:`${n.artist} - ${n.title}`})),[a]);return x(U,{data:t,getUrl:R,children:[r instanceof Error&&i(S,{children:r.message}),s&&i(b,{css:{padding:`${u.md} 0`}})]})}),_=()=>{const e=h(),{isLoading:p,error:a,data:s}=I(["fav-mappers",e],()=>g({url:`${M}/data/mappers/${e}/favored-mappers.json`}));return{isLoading:p,error:a,data:o.exports.useMemo(()=>s==null?void 0:s.map((r,t)=>({place:t+1,namesString:r.names.join(" "),id:r.mapperId,value:r.count,names:r.names})),[s])}},B=v("main",{flex:"1 1 auto",display:"flex",flexFlow:"column nowrap"}),J=v("div",{alignSelf:"center",padding:u.md,width:u.tableMaxWidth,maxWidth:"100%",margin:"0 auto"}),f=50;function K(){const{data:e,isLoading:p,error:a}=_(),[s,r]=o.exports.useState(1),[t,n]=o.exports.useState(""),[c,w]=o.exports.useState(null),E=e?e[0].value:0,d=o.exports.useMemo(()=>t&&e?y(e,t,{keys:["namesString"],baseSort:(l,L)=>l.index-L.index}):e,[e,t]),F=o.exports.useCallback(({mapper:l})=>i(W,{mapper:l}),[]),$=o.exports.useCallback(()=>{d&&d.length>s&&r(l=>l+f)},[d,s]),m=o.exports.useMemo(()=>d==null?void 0:d.slice(0,s),[s,d]);return o.exports.useEffect(()=>{r(f)},[e,t]),x(B,{children:[a instanceof Error&&i(S,{children:a.message}),p&&i(b,{css:{padding:`${u.md} 0`}}),m&&x(k,{children:[i(J,{children:i(A,{placeholder:"search names...",type:"text",onChange:n,value:t})}),i(P,{css:{flex:"1 1 0px"},ref:w,children:m.length?i(D,{mappers:m,scrollParent:c!=null?c:void 0,loadMore:$,maxValue:E,renderExpandedRow:F}):"Didn't find a mapper with this name :("})]})]})}export{K as default};
